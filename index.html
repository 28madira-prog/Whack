<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Whack-a-Mole Game</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <style>
        #gameUI {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Game UI -->
    <div id="gameUI">
        <h3>Whack-a-Mole VR</h3>
        <p>Score: <span id="score">0</span></p>
        <p>Time: <span id="timer">30</span>s</p>
        <button onclick="startGame()">Start Game</button>
    </div>

    <a-scene embedded style="height: 100vh;">
        <!-- Environment -->
        <a-sky color="#87CEEB"></a-sky>
        <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" color="#228B22"></a-plane>

        <!-- Mole Holes -->
        <a-cylinder position="-3 0.01 -3" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="0 0.01 -3" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="3 0.01 -3" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="-3 0.01 0" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="0 0.01 0" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="3 0.01 0" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="-3 0.01 3" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="0 0.01 3" radius="0.6" height="0.2" color="#654321"></a-cylinder>
        <a-cylinder position="3 0.01 3" radius="0.6" height="0.2" color="#654321"></a-cylinder>

        <!-- Moles (initially hidden underground) -->
        <a-box id="mole1" position="-3 -1 -3" width="0.8" height="0.8" depth="0.8" color="brown" class="mole" visible="false"></a-box>
        <a-sphere id="mole2" position="0 -1 -3" radius="0.4" color="darkred" class="mole" visible="false"></a-sphere>
        <a-box id="mole3" position="3 -1 -3" width="0.8" height="0.8" depth="0.8" color="brown" class="mole" visible="false"></a-box>
        <a-sphere id="mole4" position="-3 -1 0" radius="0.4" color="darkred" class="mole" visible="false"></a-sphere>
        <a-box id="mole5" position="0 -1 0" width="0.8" height="0.8" depth="0.8" color="brown" class="mole" visible="false"></a-box>
        <a-sphere id="mole6" position="3 -1 0" radius="0.4" color="darkred" class="mole" visible="false"></a-sphere>
        <a-box id="mole7" position="-3 -1 3" width="0.8" height="0.8" depth="0.8" color="brown" class="mole" visible="false"></a-box>
        <a-sphere id="mole8" position="0 -1 3" radius="0.4" color="darkred" class="mole" visible="false"></a-sphere>
        <a-box id="mole9" position="3 -1 3" width="0.8" height="0.8" depth="0.8" color="brown" class="mole" visible="false"></a-box>

        <!-- Camera with cursor -->
        <a-entity id="cameraRig" position="0 1.6 6">
            <a-camera look-controls wasd-controls cursor="fuse: true; fuseTimeout: 1500">
                <a-cursor 
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: white"
                    position="0 0 -1">
                </a-cursor>
            </a-camera>
        </a-entity>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="5 10 5" color="#ffffff"></a-light>
    </a-scene>

    <script>
        // Game variables
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let gameTimer;
        let moleTimer;

        // Get all moles
        const moles = document.querySelectorAll('.mole');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');

        // Wait for A-Frame to load
        document.querySelector('a-scene').addEventListener('loaded', function () {
            console.log('Scene loaded!');
            
            // Add click event listeners to moles
            moles.forEach((mole, index) => {
                mole.addEventListener('click', () => hitMole(mole, index + 1));
            });
        });

        function startGame() {
            score = 0;
            timeLeft = 30;
            gameActive = true;
            
            updateUI();
            console.log('Game started!');
            
            // Start the countdown timer
            gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
            
            // Start spawning moles
            spawnMole();
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameTimer);
            clearTimeout(moleTimer);
            
            // Hide all moles
            moles.forEach(mole => {
                mole.setAttribute('visible', false);
                mole.setAttribute('position', mole.getAttribute('position').x + ' -1 ' + mole.getAttribute('position').z);
            });
            
            alert(`Game Over! Final Score: ${score}`);
        }

        function hitMole(mole, moleNumber) {
            if (!gameActive || !mole.getAttribute('visible')) return;
            
            score += 5;
            updateUI();
            
            console.log(`Hit mole ${moleNumber}! Score: ${score}`);
            
            // Hide the mole and move it underground
            mole.setAttribute('visible', false);
            const pos = mole.getAttribute('position');
            mole.setAttribute('position', pos.x + ' -1 ' + pos.z);
        }

        function spawnMole() {
            if (!gameActive) return;
            
            // Hide all moles first
            moles.forEach(mole => {
                mole.setAttribute('visible', false);
                const pos = mole.getAttribute('position');
                mole.setAttribute('position', pos.x + ' -1 ' + pos.z);
            });
            
            // Pick a random mole to show
            const randomMole = moles[Math.floor(Math.random() * moles.length)];
            const pos = randomMole.getAttribute('position');
            
            // Move mole up and make visible
            randomMole.setAttribute('position', pos.x + ' 0.5 ' + pos.z);
            randomMole.setAttribute('visible', true);
            
            console.log('Mole spawned!');
            
            // Hide the mole after 2 seconds
            setTimeout(() => {
                if (gameActive && randomMole.getAttribute('visible')) {
                    randomMole.setAttribute('visible', false);
                    const pos = randomMole.getAttribute('position');
                    randomMole.setAttribute('position', pos.x + ' -1 ' + pos.z);
                }
            }, 2000);
            
            // Spawn next mole in 1-3 seconds
            moleTimer = setTimeout(spawnMole, Math.random() * 2000 + 1000);
        }

        function updateUI() {
            scoreElement.textContent = score;
            timerElement.textContent = timeLeft;
        }
    </script>
</body>
</html>
